<!doctype html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <meta name="google-site-verification" content="N_KLIKDoMh-B--60g4igKeIsKAlZpBrxyDzhJYWW54A" />
    <meta name="author" content="Christian BOUNGOU | chrisBdev">
    <title>{% block title %}Arbre de clôture v1.9{% endblock %}</title>
    <meta name="description" content="{% block description %}scc-tool.com contient l'outil dit 'Arbre de clôture' pour les services de proximités (SDP) de l'entreprise SCC présents sur les comptes client SAFRAN{% endblock %}">
    <meta name="keywords" content="{% block keyswords %}Arbre de clôture, SCC, SAFRAN, SNOW, Service Now, SDP, Support informatique, SDS, SAE, SLS, scc-tool{% endblock %}">
    <script src="https://code.jquery.com/jquery-3.0.0.js"></script>
{#    <script src="https://code.jquery.com/jquery-migrate-3.3.2.js"></script>#}
    <script src="https://twitter.github.io/typeahead.js/releases/latest/typeahead.bundle.js"></script>
    {% block stylesheets %}
        {{ encore_entry_link_tags('app') }}
    {% endblock %}
</head>
<body class="has-navbar-fixed-top">

<nav class="navbar is-light has-text-black is-fixed-top" role="navigation" aria-label="main navigation">
    <div class="navbar-brand">
        <a class="navbar-item" href="{{ path('home') }}">
            <div class="field is-grouped is-justify-content-center">
                <figure class="is-flex is-justify-content-center is-align-items-center control">
                    <img width="100" height="100" src="{{ asset('build/images/sitelogo_SCC.9f1fb72d.png') }}" alt="" style="width: 124px">
                </figure>
                <p class="control is-flex is-align-items-center">
                    <b>Arbre de clôture | v1.9</b>
                </p>
            </div>
        </a>
    </div>

    {% if app.user %}
    <div class="navbar-end has-text-centered">
        <div class="navbar-item">
            <div class="tags has-addons is-justify-content-center">
                    <span class="tag is-white is-medium ">
                        {{ app.user.username }}
                    </span>
                    <a href="{{ path('app_logout') }}" class="tag button is-danger is-medium ">
                        <span class="icon">
                            <i class="fas fa-door-open"></i>
                        </span>
                    </a>
            </div>
        </div>
    </div>
    {% endif %}

</nav>

{{ include('includes/flash_message.html.twig') }}

<section class="is-fullheight is-flex is-justify-content-center is-align-items-center section-base-html">
    <img class="safran-backgound-img" src="{{ asset('build/images/1200px-Safran_-_logo_2016.f3a8e511.png') }}" alt="">
    <div class="column is-flex-desktop is-align-items-center is-justify-content-center">
        {% block body %}{% endblock %}
    </div>
</section>

    <script>
        function goBack() {
            window.history.back();
        }
    </script>

    {% block javascripts %}
        <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
        <script>
            function checkRadio(radio){
                let thisRadio = radio.querySelector('.radio-select');
                thisRadio.checked = true;
            }
        </script>



{#    JS POUR FORMULAIRE DYNAMIQUE    #}
        <script>

            let input = document.querySelectorAll(".js-on-change");
            let dynamicFields = document.querySelectorAll(".dynamic-field");
            let fieldAssets = document.getElementById('assets-field');
            let asset_ae = document.getElementById('asset_ae');
            // let fieldAs = document.getElementById('as-field');
            let asset_as = document.getElementById('asset_as');
            let fieldTpx = document.getElementById('tpx-field');
            let fieldRsdp = document.getElementById('rspd-field');

            input.forEach(element => element.addEventListener('input', updateValue) );
            // dynamicFields.forEach(element => console.log(element) );

            window.onload = function(){
                // input.forEach(element => console.log(element.value) )
                updateValue();
            } ;

            function updateValue(e) {
                let valueString = '';
                input.forEach(element => valueString = valueString + element.value);
                initializeAssetsForm();
                if (valueString.includes('DEM_PDT') || valueString.includes('PRT') || valueString.includes('NDO') ){
                    updateFieldsVisibility(fieldAssets);
                    updateFieldsVisibility(fieldRsdp);
                    updateFieldsVisibility(fieldTpx);
                    asset_ae.attributes.removeNamedItem('disabled');
                }else if (valueString.includes('REP_PDT')) {
                    updateFieldsVisibility(fieldAssets);
                    updateFieldsVisibility(fieldRsdp);
                    updateFieldsVisibility(fieldTpx);
                    asset_as.attributes.removeNamedItem('disabled');
                }else if (valueString.includes('REN')) {
                    updateFieldsVisibility(fieldAssets);
                    updateFieldsVisibility(fieldRsdp);
                    updateFieldsVisibility(fieldTpx);
                    asset_ae.attributes.removeNamedItem('disabled');
                    asset_as.attributes.removeNamedItem('disabled');
                }
            }



            function initializeAssetsForm() {
                hiddeAllFields();
                asset_ae.setAttribute('disabled', true);
                asset_ae.value = null;
                asset_as.setAttribute('disabled', true);
                asset_as.value = null;
            }
            function hiddeAllFields() {
                dynamicFields.forEach(element => element.classList.add('is-hidden') );
            }
            function updateFieldsVisibility(element) {
                element.classList.remove('is-hidden')
            }

        </script>

        {#               SCRIPT POUR AJAX                   #}
        <script>

            function removeAsset(event){
                let assetTag = event.target.parentElement.parentElement;
                assetTag.style.display = 'none';
                event.preventDefault();

                const url = this.href;

                axios.get(url).then(function (response) {

                })
            }

            let removeBtn = document.querySelectorAll('a.ajax-remove-asset').forEach(function (link){
                link.addEventListener('click' || 'touchstart', removeAsset);
            });



            // $('#asset-btn-form').on('click', function(e){
            //     e.preventDefault();
            //
            //         const url = this.baseURI;
            //         console.log(url);
            //     axios.get(url).then(function (response) {
            //     });
            // });

            function addAsset(event){
                console.log(this.action);
                // assetTag.style.display = 'none';
                event.preventDefault();

                const url = this.action;
                const formData = $(this).serialize();
                axios.post(url,formData).then(function (response) {

                });

                // return false;
            }

            let ajaxForm = document.querySelectorAll('form.ajax-add-asset');

            ajaxForm.forEach(function (form) {
                // let btn = form.querySelector('button');

                form.addEventListener('click', addAsset);
            })

        </script>


    {% endblock %}
</body>
</html>
